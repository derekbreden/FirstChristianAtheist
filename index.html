<!doctype html>
<html>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
  />
  <link
    rel="apple-touch-icon"
    sizes="180x180"
    href="/apple-touch-icon.png?v=5"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="/favicon-32x32.png?v=5"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="16x16"
    href="/favicon-16x16.png?v=5"
  />
  <link rel="manifest" href="/site.webmanifest?v=5" />
  <link rel="mask-icon" href="/safari-pinned-tab.svg?v=5" color="#5bbad5" />
  <link rel="shortcut icon" href="/favicon.ico?v=5" />
  <meta name="msapplication-TileColor" content="#da532c" />
  <meta name="theme-color" content="#ffffff" />
  <style>
    * {
      font-family: Arial;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }
    body {
      position: relative;
      font-size: 14px;
      display: flex;
      justify-content: center;
      background-image: repeating-linear-gradient(
        90deg,
        #bbc8d7 0%,
        #bbc8d7 calc((100% - 480px) / 2),
        #fff calc((100% - 480px) / 2),
        #fff calc((100% - 480px) / 2 + 480px),
        #bbc8d7 calc((100% - 480px) / 2 + 480px),
        #bbc8d7 100%
      );
      color: #26323e;
    }
    main-content {
      display: flex;
      flex-direction: column;
      padding: 44px 40px 20px 40px;
      max-width: 480px;
    }
    @media (max-width: 480px) {
      body {
        background: #fff;
      }
      main-content {
        padding: 44px 20px 20px 20px;
      }
    }
    a,
    a:visited,
    a:active {
      color: #26323e;
    }
    h2 {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    p {
      margin-top: 10px;
    }
    p img {
      max-width: 100%;
      border-radius: 10px;
    }
    p[quote] {
      padding: 10px;
      border-left: 2px solid #999;
      background: #f5f5f5;
    }
    li {
      margin-top: 10px;
      margin-left: 20px;
    }
    debug {
      white-space: pre;
    }
    header {
      position: fixed;
      top: 0;
      left: 0;
      background: #fff;
      right: 0;
      height: 44px;
      display: flex;
      align-items: center;
      box-shadow: 0px 0px 5px #26323e;
    }
    header h1 {
      font-size: 18px;
      font-weight: bold;
      display: flex;
      align-items: center;
      margin: 0 20px;
    }
    header h1 img {
      height: 24px;
      width: 24px;
      margin-right: 5px;
    }
    header hamburger {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 74px;
      padding: 10px 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
    }
    header hamburger line {
      border: 2px solid #27323e;
      border-radius: 2px;
      width: 100%;
    }
    menu {
      display: none;
      flex-direction: column;
      position: fixed;
      top: 0;
      right: 0;
      z-index: 3;
      background: #fff;
      box-shadow: 0px 0px 5px #26323e;
      border-radius: 0 0 0 2px;
    }
    menu signed-in,
    menu sign-in,
    modal {
      display: flex;
      flex-direction: column;
      padding: 20px 20px 10px 20px;
      position: relative;
      width: 280px;
    }
    menu signed-in {
      display: none;
    }
    menu signed-in > *,
    menu sign-in > *,
    modal > * {
      margin-bottom: 10px;
    }
    menu links {
      display: flex;
      flex-direction: column;
    }
    menu links a {
      text-decoration: none;
      font-weight: bold;
      display: flex;
      align-items: center;
      padding: 10px 20px;
      border-bottom: 1px solid #999;
    }
    modal-bg {
      display: none;
      background: #00000077;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 2;
    }
    input {
      font-size: 14px;
      width: 240px;
      border-radius: 2px;
      border: 1px solid #26323e;
      padding: 10px;
    }
    button {
      font-size: 14px;
      -webkit-appearance: none;
      border-radius: 2px;
      border: 0;
      background: #26323e;
      color: #fff;
      padding: 10px;
      font-weight: bold;
    }
    button[alt] {
      background: #f5f5f5;
      color: #26323e;
      border: 1px solid #999;
    }
    info,
    error {
      padding: 10px 10px 10px 36px;
      position: relative;
      background: #ffeeee;
      border: 1px solid #b66;
      color: #b66;
      border-radius: 2px;
      max-width: 100%;
      display: none;
    }
    info[show],
    error[show] {
      display: flex;
    }
    info::before,
    error::before {
      content: "!";
      position: absolute;
      left: 10px;
      top: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 20px;
      background: #b66;
      color: #ffeeee;
      font-size: 14px;
      font-weight: bold;
      height: 17px;
      width: 17px;
    }
    info {
      border-color: #48c;
      background: #e0f0ff;
      color: #48c;
    }
    info::before {
      content: "i";
      background: #48c;
      color: #e0f0ff;
    }
    password-wrapper {
      display: flex;
      align-items: center;
    }
    password-wrapper input {
      width: 218px;
    }
    password-help {
      display: flex;
      align-items: center;
      padding: 10px 0 9px 5px;
    }
    password-help::before {
      content: "?";
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 20px;
      background: #48c;
      color: #e0f0ff;
      font-weight: bold;
      height: 17px;
      width: 17px;
    }
    modal {
      position: fixed;
      display: none;
      flex-direction: column;
      z-index: 3;
      top: 64px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border-radius: 2px;
      box-shadow: 0px 0px 5px #26323e;
    }
  </style>
  <head>
    <title>First Christian Atheist</title>
  </head>
  <body>
    <header>
      <h1>
        <img src="/logo.png" alt="A logo consisting of a dove and a heart" />
        First Christian Atheist
      </h1>
      <hamburger>
        <line></line>
        <line></line>
        <line></line>
      </hamburger>
    </header>
    <menu>
      <links>
        <a href="/">Home</a>
        <a href="/topics">Topics</a>
      </links>
      <sign-in>
        <input placeholder="Email" type="email" autocomplete="email" />
        <password-wrapper>
          <input
            placeholder="Password"
            type="password"
            autocomplete="current-password"
          />
          <password-help></password-help>
        </password-wrapper>
        <button submit>Sign Up / Sign In</button>
        <button alt cancel>Cancel</button>
        <error></error>
        <info></info>
      </sign-in>
      <signed-in>
        <button sign-out>Log Out</button>
      </signed-in>
    </menu>
    <main-content>
      <debug></debug>

      <h2>What can be done to demonstrate unconditional love for all?</h2>
      <p>
        Exploring answers to this question together without judgement or
        authority is the only goal here.
      </p>
      <p>
        <img
          src="love.gif"
          alt="A line drawing depicts Jesus with four chat bubbles: a heart around the Earth, a storm cloud, a person kneeling, and a trio of a fire and cross and clouds. Three of the chat bubbles and Jesus are animated out of the frame, only the heart around the earth remains, and is zoomed in on."
        />
      </p>

      <h2>The Bible</h2>
      <p quote>
        Everything we know about God's Word is summed up in a single sentence:
        Love others as you love yourself.<br />
        <br />
        — Galatians 5:14 [The Message Bible by Eugene Peterson]
      </p>

      <h2>Bishop John Shelby Spong</h2>
      <p quote>
        The church is still caught in pre-Darwinian pre-Copernican categories.
        The idea that we were born in sin is a very strange idea when you’re
        past Darwin. You know the idea that there was an original perfection
        from which you fell and had to be redeemed doesn’t make a lot of sense
        if you see life as emerging over 13.8 billion years from the beginning
        of this universe. And so we’ve got to begin to lift what I think is the
        Christ experience out of the explanations of antiquity, and then find a
        new way to make that experience live, and I think we do this in other
        areas of life all the time, but we don’t know how to do this in
        religion.<br />
        <br />
        —
        <a href="https://youtu.be/LnDOsdDI9Vs?t=95"
          >https://youtu.be/LnDOsdDI9Vs?t=95</a
        >
      </p>

      <h2>Acceptance</h2>
      <p>
        Christianity as it is today does not accept unrepentant atheists, with
        the exception of Unitarian Universalism, which prioritizes worship and
        reverence. This leaves little room for the type of pragmatic and deep
        discussion that can be had here.
      </p>
      <p>
        Perhaps here we can have a sanctuary, for those few of us who have
        something we wish to salvage from the wreckage that is Christianity's
        encounter with the modern age, some value that we seek to carry forward
        without the theistic baggage.
      </p>

      <p>
        <b>
          I hope to add more interaction on this site, in the mean time you may
          reach me at
          <a href="https://x.com/abrleth">https://x.com/abrleth</a>
        </b>
      </p>
    </main-content>
    <modal-bg></modal-bg>
    <modal password-help>
      <input placeholder="Email" type="email" autocomplete="email" />
      <button submit>Reset Password</button>
      <button alt cancel>Cancel</button>
      <error></error>
      <info></info>
    </modal>
    <modal password-reset>
      <input
        placeholder="New Password"
        type="password"
        autocomplete="new-password"
      />
      <button submit>Set Password</button>
      <button alt cancel>Cancel</button>
      <error></error>
      <info></info>
    </modal>
    <modal info>
      <info show></info>
      <button close>Okay</button>
    </modal>
    <modal error>
      <error show></error>
      <button close>Okay</button>
    </modal>
  </body>
  <script>
    // Debug and library setup
    const $ = (selector) => {
      const $this = document.querySelector(selector);
      $this.on = $this.addEventListener.bind($this);
      return $this;
    };
    const debug = function () {
      // $("debug").innerHTML = JSON.stringify([...arguments]);
    };
    window.addEventListener("error", ($error) => {
      debug($error.message);
    });

    // Read URL
    let path = "";
    const paths = window.location.pathname.split("/").filter((x) => x);
    let reset_token_uuid = "";
    if (paths[0] === "reset") {
      reset_token_uuid = paths[1] || "";
    } else if (paths[0]) {
      path = paths[0];
    }

    // Session start
    let session_uuid = localStorage.getItem("session_uuid") || "";
    const startSession = () => {
      const postBody = {
        session_uuid,
      };
      if (reset_token_uuid) {
        postBody.reset_token_uuid = reset_token_uuid;
      }
      fetch("/session", {
        method: "POST",
        body: JSON.stringify(postBody),
      })
        .then((response) => response.json())
        .then(function (data) {
          session_uuid = data.session_uuid;
          localStorage.setItem("session_uuid", session_uuid);
          if (data.email) {
            signInSuccess(data.email);
            if (reset_token_uuid) {
              $("modal[password-reset]").style.display = "flex";
              $("modal-bg").style.display = "flex";
            }
          }
          if (data.error) {
            modalError(data.error);
          }
        })
        .catch(function (error) {
          debug(error.message);
        });
    };
    startSession();

    // Menu
    $("header hamburger").on("click", () => {
      $("menu").style.display = "flex";
      $("modal-bg").style.display = "flex";
    });
    const menuCancel = () => {
      $("menu").style.display = "none";
      $("modal-bg").style.display = "none";
      $("sign-in error").style.display = "none";
      $("sign-in [type=email]").value = "";
      $("sign-in [type=password]").value = "";
    };
    $("menu [cancel]").on("click", menuCancel);
    $("modal-bg").on("click", menuCancel);

    // Generic modal info
    const modalInfoCancel = () => {
      $("modal[info]").style.display = "none";
      $("modal-bg").style.display = "none";
    };
    $("modal[info] [close]").on("click", modalInfoCancel);
    $("modal-bg").on("click", modalInfoCancel);
    const modalInfo = (message) => {
      $("modal[info] info").innerHTML = message;
      $("modal[info]").style.display = "flex";
      $("modal-bg").style.display = "flex";
    };

    // Generic modal error
    const modalErrorCancel = () => {
      $("modal[error]").style.display = "none";
      $("modal-bg").style.display = "none";
    };
    $("modal[error] [close]").on("click", modalErrorCancel);
    $("modal-bg").on("click", modalErrorCancel);
    const modalError = (message) => {
      $("modal[error] error").innerHTML = message;
      $("modal[error]").style.display = "flex";
      $("modal-bg").style.display = "flex";
    };

    // Sign Up / Sign In
    const signInError = (error) => {
      if (error) {
        $("sign-in error").style.display = "flex";
        $("sign-in error").innerHTML = error;
      } else {
        $("sign-in error").style.display = "none";
      }
    };
    const signInSuccess = (email) => {
      localStorage.setItem("email", email);
      $("sign-in").style.display = "none";
      $("signed-in").style.display = "flex";
    };
    $("sign-in [type=email]").on("focus", () => {
      signInError();
    });
    $("sign-in [type=password]").on("focus", () => {
      signInError();
    });
    $("sign-in [type=email]").on("keyup", (ev) => {
      if (ev.key === "Enter") {
        $("sign-in button[submit]").click();
      }
    });
    $("sign-in [type=password]").on("keyup", (ev) => {
      if (ev.key === "Enter") {
        $("sign-in button[submit]").click();
      }
    });
    $("sign-in button[submit]").on("click", () => {
      signInError();
      const email = $("sign-in [type=email]").value;
      if (!$("sign-in [type=email]").checkValidity() || !email) {
        signInError("Please enter a valid email address");
        return;
      }
      const password = $("sign-in [type=password]").value;
      if (!password) {
        signInError("Please enter a password");
        return;
      }
      $("sign-in info").innerHTML = "Validating...";
      $("sign-in info").style.display = "flex";
      fetch("/session", {
        method: "POST",
        body: JSON.stringify({
          session_uuid,
          email,
          password,
        }),
      })
        .then((response) => response.json())
        .then(function (data) {
          $("sign-in info").style.display = "none";
          if (data.error || !data.success) {
            signInError(data.error || "Server error");
            return;
          }
          signInSuccess(email);
          menuCancel();
        })
        .catch(function (error) {
          $("sign-in info").style.display = "none";
          signInError("Network error");
        });
    });
    $("signed-in button[sign-out]").on("click", () => {
      session_uuid = "";
      reset_token_uuid = "";
      startSession();
      $("sign-in").style.display = "flex";
      $("signed-in").style.display = "none";
    });

    // Forgot Password
    const passwordHelpCancel = () => {
      $("modal[password-help]").style.display = "none";
      $("modal-bg").style.display = "none";
      $("modal[password-help] error").style.display = "none";
      $("modal[password-help] [type=email]").value = "";
    };
    const passwordHelpError = (error) => {
      if (error) {
        $("modal[password-help] error").style.display = "flex";
        $("modal[password-help] error").innerHTML = error;
      } else {
        $("modal[password-help] error").style.display = "none";
      }
    };
    $("modal[password-help] [type=email]").on("focus", () => {
      passwordHelpError();
    });
    $("modal[password-help] [type=email]").on("keyup", (ev) => {
      if (ev.key === "Enter") {
        $("modal[password-help] button[submit]").click();
      }
    });
    $("password-help").on("click", () => {
      menuCancel();
      $("modal-bg").style.display = "flex";
      $("modal[password-help]").style.display = "flex";
    });
    $("modal-bg").on("click", passwordHelpCancel);
    $("modal[password-help] [cancel]").on("click", passwordHelpCancel);
    $("modal[password-help] button[submit]").on("click", () => {
      passwordHelpError();
      const email = $("modal[password-help] [type=email]").value;
      if (!$("modal[password-help] [type=email]").checkValidity() || !email) {
        passwordHelpError("Please enter a valid email address");
        return;
      }
      $("modal[password-help] info").innerHTML = "Validating...";
      $("modal[password-help] info").style.display = "flex";
      fetch("/session", {
        method: "POST",
        body: JSON.stringify({
          session_uuid,
          email,
        }),
      })
        .then((response) => response.json())
        .then(function (data) {
          $("modal[password-help] info").style.display = "none";
          if (data.error || !data.success) {
            passwordHelpError(data.error || "Server error");
            return;
          }
          passwordHelpCancel();
          modalInfo("An email was sent with password reset instructions.");
        })
        .catch(function (error) {
          $("modal[password-help] info").style.display = "none";
          passwordHelpError("Network error");
        });
    });

    // Resetting Password
    const passwordResetCancel = () => {
      $("modal[password-reset]").style.display = "none";
      $("modal-bg").style.display = "none";
      $("modal[password-reset] error").style.display = "none";
      $("modal[password-reset] [type=password]").value = "";
    };
    const passwordResetError = (error) => {
      if (error) {
        $("modal[password-reset] error").style.display = "flex";
        $("modal[password-reset] error").innerHTML = error;
      } else {
        $("modal[password-reset] error").style.display = "none";
      }
    };
    $("modal[password-reset] [type=password]").on("focus", () => {
      passwordResetError();
    });
    $("modal[password-reset] [type=password]").on("keyup", (ev) => {
      if (ev.key === "Enter") {
        $("modal[password-reset] button[submit]").click();
      }
    });
    $("modal-bg").on("click", passwordResetCancel);
    $("modal[password-reset] [cancel]").on("click", passwordResetCancel);
    $("modal[password-reset] button[submit]").on("click", () => {
      passwordResetError();
      const password = $("modal[password-reset] [type=password]").value;
      if (!password) {
        passwordResetError("Please enter a new password");
        return;
      }
      $("modal[password-reset] info").innerHTML = "Validating...";
      $("modal[password-reset] info").style.display = "flex";
      fetch("/session", {
        method: "POST",
        body: JSON.stringify({
          session_uuid,
          reset_token_uuid,
          password,
        }),
      })
        .then((response) => response.json())
        .then(function (data) {
          $("modal[password-reset] info").style.display = "none";
          if (data.error || !data.success) {
            passwordResetError(data.error || "Server error");
            return;
          }
          passwordResetCancel();
          modalInfo("Your password has been set.");
          history.pushState({}, "", "/");
        })
        .catch(function (error) {
          $("modal[password-reset] info").style.display = "none";
          passwordResetError("Network error");
        });
    });
  </script>
</html>
